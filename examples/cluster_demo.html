<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style type="text/css">
        #left {
            float: left;
            width: 300px;
        }
        #map {

            height: 500px;
            width: 500px;
            float: left;
            border: 1px solid black;
        }

    </style>
    <link rel="stylesheet" type="text/css" href="../lib/OpenLayers-2.13.1/theme/default/style.css">
</head>
<body>

<h1>Cluster demo</h1>

<div id="map"></div>



<script type="text/javascript" src="../vendor/jquery/dist/jquery.min.js"></script>
<script type="text/javascript" src="../vendor/underscore/underscore-min.js"></script>
<script type="text/javascript" src="../vendor/backbone/backbone.js"></script>
<script type="text/javascript" src="../lib/OpenLayers-2.13.1/OpenLayers.js"></script>
<script type="text/javascript" src="../dist/ol2/bwmaplib_ol2.min.js"></script>
<script type="text/javascript" src="../dist/ol2/clusterstyle.min.js"></script>
<script type="text/javascript" src="../dist/ol2/markers.min.js"></script>

<script type="text/javascript">
(function () {
    'use strict';

    var map = new BW.MapCore.MapConfig(
        'map',
        {
            theme: null, //set theme to null, this means that OpenLayers won't load css
            baseLayers: [
                {id: 2, visible: true}
            ],
            baseLayerList: [
                {
                    id: 1,
                    protocol: 'WMTS',
                    name: 'Hovedkart Sjø',
                    url: 'http://opencache.statkart.no/gatekeeper/gk/gk.open_wmts?',
                    layerName: 'sjo_hovedkart2'
                },
                {
                    id: 2,
                    protocol: 'WMTS',
                    name: 'Havbunn Grunnkart',
                    url: 'http://opencache.statkart.no/gatekeeper/gk/gk.open_wmts?',
                    layerName: 'havbunn_grunnkart'
                },
                {
                    id: 101,
                    protocol: 'WMS',
                    name: 'Fartøy med oljevernutstyr',
                    url: 'http://kart.kystverket.no/wms.aspx',
                    layerName: 'layer_452',
                    tiled: false
                }
            ]
        }
    );

    function createFeatures (extent) {
        var dx = 200000;
        var dy = 200000;
        var px, py;
        var features = [];
        for(var x = extent.left; x <= extent.right; x += dx) {
            for(var y = extent.bottom; y <= extent.top; y += dy) {
                px = x + (2 * dx * (Math.random() - 0.5));
                py = y + (2 * dy * (Math.random() - 0.5));
                features.push(new OpenLayers.Feature.Vector(
                    new OpenLayers.Geometry.Point(px, py), {x: px, y: py}
                ));
            }
        }
        return features;
    }

    var clusterStyleMap = BW.MapCore.createClusterStyleMap(
        'sky',
        BW.MapCore.Markers('../img/markers').createStyleDict('sky', 'md')
    );

    var clusterStrategy = new OpenLayers.Strategy.Cluster();
    clusterStrategy.distance = 50;
    var clusters = new OpenLayers.Layer.Vector('Clusters', {
        strategies: [clusterStrategy],
        styleMap: clusterStyleMap
    });
    var f = createFeatures(map.map.getMaxExtent());
    var select = new OpenLayers.Control.SelectFeature(
        clusters,
        {hover: true}
    );
    map.map.addControl(select);
    select.activate();

    map.map.addLayers([clusters]);
    clusters.addFeatures(f);

}());
</script>

</body>
</html>
